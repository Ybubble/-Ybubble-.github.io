

<!DOCTYPE html>
<html lang="zn-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/1.jpg">
  <link rel="icon" href="/img/1.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="3.5.4 Reliable Data Transfer   TCP creates a reliable data transfer service(å¯é æ•°æ®ä¼ è¾“) on top of IPâ€™s unreliable best-effort service   TCPâ€™s reliable data transfer service ensures that the data stream th">
<meta property="og:type" content="article">
<meta property="og:title" content="ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆäº”ï¼‰">
<meta property="og:url" content="https://ybubble.github.io/2024/02/20/%E7%AC%AC%E4%B8%89%E7%AB%A0%E8%BF%90%E8%BE%93%E5%B1%825/index.html">
<meta property="og:site_name" content="Bubble&#39;s Blog">
<meta property="og:description" content="3.5.4 Reliable Data Transfer   TCP creates a reliable data transfer service(å¯é æ•°æ®ä¼ è¾“) on top of IPâ€™s unreliable best-effort service   TCPâ€™s reliable data transfer service ensures that the data stream th">
<meta property="og:locale" content="zn_CN">
<meta property="article:published_time" content="2024-02-20T04:40:44.581Z">
<meta property="article:modified_time" content="2024-02-20T07:32:14.446Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆäº”ï¼‰ - Bubble&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"ybubble.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Bubble</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Category</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/3.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆäº”ï¼‰"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-02-20 12:40" pubdate>
          February 20, 2024 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    

    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆäº”ï¼‰</h1>
            
            
              <div class="markdown-body">
                
                <h3 id="3-5-4-Reliable-Data-Transfer">3.5.4 Reliable Data Transfer</h3>
<ul>
<li>
<p>TCP creates a <strong>reliable data transfer service</strong>(å¯é æ•°æ®ä¼ è¾“) on top of IPâ€™s unreliable best-effort service</p>
</li>
<li>
<p>TCPâ€™s reliable data transfer service ensures that the data stream that a process reads out of its TCP receive buffer is <u>uncorrupted</u>æ— æŸå, <u>without gaps</u>æ— é—´éš”, <u>without duplication</u>éå†—ä½™,and <u>in sequence</u>æŒ‰åºï¼ŒÂ·Â·Â·å®Œå…¨ç›¸åŒ</p>
</li>
<li>
<p>TCP sender three events:TCP å‘é€æ–¹ä¸‰ä¸ªé‡è¦äº‹ä»¶</p>
<ul>
<li>
<p>data received from application above</p>
<ul>
<li>
<p>TCP receives data from the application, encapsulates the data in a segment, and passes the segment to IP</p>
</li>
<li>
<p><strong>each segment</strong> includes a <strong>sequence number</strong> that is the <strong>byte-stream number of the first data byte</strong> in the segment, è¿™ä¸ªåºå·å°±æ˜¯è¯¥æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„å­—èŠ‚æµç¼–å·</p>
</li>
<li>
<p>if the timer is already not running for some other segment, TCP starts the timer when the segment is passed to IP</p>
<p>ï¼ˆthink of timer as for oldest  unacked segmentï¼Œexpiration interval: TimeOutIntervalï¼‰</p>
</li>
</ul>
</li>
<li>
<p>timeout (è¶…æ—¶)</p>
<ul>
<li>retransmit segment that  caused timeout(é‡ä¼ å¯¼è‡´è¶… æ—¶äº‹ä»¶çš„æŠ¥æ–‡)</li>
<li>restart timer</li>
</ul>
</li>
<li>
<p>ack rcvd (æ”¶åˆ°ACK):</p>
</li>
<li>
<p>if ack acknowledges  previously unacked segments</p>
<ul>
<li>
<p>update what is known to  be ACKed (cumulative  acknowledgmentsç´¯è®¡ç¡®è®¤)</p>
</li>
<li>
<p>start timer if there are  still unacked segments</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Set TimeoutInterval during  sender three events:ï¼ˆin most of TCP implementationï¼‰</p>
<ul>
<li>data rcvd from app (æ”¶åˆ°APPå‘é€çš„æ•°æ®äº‹ä»¶):
<ul>
<li>TimeoutInterval = EstimatedRTT + 4*DevRTT *</li>
</ul>
</li>
<li>timeout (è¶…æ—¶äº‹ä»¶):
<ul>
<li>TimeoutInterval is doubled, if timeout occurs  again, the TimeoutInterval is 4 times, unless the  segment is received and EstimatedRTT is updated</li>
</ul>
</li>
<li>ack rcvd (æ”¶åˆ°ACKäº‹ä»¶):
<ul>
<li>TimeoutInterval = EstimatedRTT + 4*DevRTT</li>
</ul>
</li>
</ul>

</li>
<li>
<p>ä¾‹</p>

</li>
<li>
<p>ç¬¬äºŒç§æƒ…å†µï¼šå½“è¶…æ—¶äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¸»æœº A é‡ä¼ åºå·92çš„ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œå¹¶é‡å¯å®šæ—¶å™¨ã€‚åªè¦ç¬¬äºŒä¸ªæŠ¥æ–‡æ®µçš„ ACK åœ¨æ–°çš„è¶…æ—¶å‘ç”Ÿä»¥å‰åˆ°è¾¾ï¼Œåˆ™ç¬¬äºŒä¸ªæŠ¥æ–‡æ®µå°†ä¸ä¼šè¢«é‡ä¼ </p>
</li>
</ul>

<ul>
<li>è¶…æ—¶äº‹ä»¶å‘ç”Ÿä¹‹å‰ä¸»æœºAæ”¶åˆ°ä¸€ä¸ªç¡®è®¤å·ä¸º 120çš„ç¡®è®¤æŠ¥æ–‡ã€‚ä¸»æœº A å› è€ŒçŸ¥é“ä¸»æœºä¸»æœºBå·²ç»æ”¶åˆ°äº†åºå·ä¸º119åŠä¹‹å‰çš„æ‰€æœ‰å­—èŠ‚; æ‰€ä»¥ä¸»æœºAä¸ä¼šé‡ä¼ è¿™ä¸¤ä¸ªæŠ¥æ–‡æ®µä¸­çš„ä»»ä½•ä¸€ä¸ª</li>
</ul>
<h6 id="Doubling-the-Timeout-Intervalï¼Œè¶…æ—¶é—´éš”åŠ å€">Doubling the Timeout Intervalï¼Œè¶…æ—¶é—´éš”åŠ å€</h6>
<ul>
<li>whenever the timeout event occurs, TCP retransmits the <strong>not-yet-acknowledged segment</strong> with the <strong>smallest sequence</strong> number</li>
<li>æ¯æ¬¡TCPé‡ä¼ æ—¶éƒ½ä¼šå°†ä¸‹ä¸€æ¬¡çš„è¶…æ—¶é—´éš”è®¾ä¸ºå…ˆå‰å€¼çš„<strong>ä¸¤å€</strong>ï¼Œè€Œä¸æ˜¯ç”¨ä» EstimatedRTT å’ŒDevRTTæ¨ç®—å‡ºçš„å€¼</li>
<li>the intervals grow exponentially after each retransmissionï¼Œè¶…æ—¶é—´éš”åœ¨æ¯æ¬¡é‡ä¼ åä¼šå‘ˆæŒ‡æ•°å‹å¢é•¿</li>
</ul>
<h6 id="Fast-Retransmitï¼Œå¿«é€Ÿé‡ä¼ ">Fast Retransmitï¼Œå¿«é€Ÿé‡ä¼ </h6>
<ul>
<li>
<p>One of the problems with <u>timeout-triggered retransmissions</u>(è§¦å‘è¶…æ—¶é‡ä¼ ) is that the <u>timeout period</u>(è¶…æ—¶å‘¨æœŸ) can be relatively long. When a segment is <u>lost</u>, this long timeout period forces the sender to <u>delay</u> resending the lost packet, thereby <strong>increasing the end-to-end delay</strong></p>
<p>==ã€‹ the sender can often detect(æ£€æµ‹ï¼Œå‘ç°) packet loss well before the timeout event occurs by noting so-called <strong>duplicate ACK</strong>ï¼ˆå†—ä½™ACKï¼‰</p>
</li>
<li>
<p>TCP ACK generation recommendation(ä»‹ç»ï¼Œå»ºè®®)</p>
</li>
<li>
<table>
<thead>
<tr>
<th>event at receiver</th>
<th>TCP receiver action</th>
</tr>
</thead>
<tbody>
<tr>
<td>arrival of in-order segment with expected seq #. All data up to expected seq # already ACKed</td>
<td>delayed ACK. Wait up to 500ms for next segment. If no next segment, send ACK</td>
</tr>
<tr>
<td>arrival of in-order segment with expected seq #. One other  segment has ACK pending</td>
<td>immediately send single cumulative  ACK, ACKing both in-order segments</td>
</tr>
<tr>
<td>arrival of out-of-order segment higher-than-expect seq. # . Gap detected (å¤§äºé¢„æœŸã€é¡ºåºç¼–å·çš„æŠ¥æ–‡ï¼Œå³æ£€æµ‹åˆ°ç©ºç™½åŒºåŸŸ)</td>
<td>immediately send duplicate ACK(å†—ä½™ACK),  indicating seq. # of next expected byte (æŒ‡æ˜ä¸‹ä¸€ä¸ªæœŸå¾…çš„æŠ¥æ–‡ç¼–å·)</td>
</tr>
<tr>
<td>arrival of segment that  partially or completely fills gap</td>
<td>immediate send ACK, provided that segment starts at lower end of gap</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>time-out period often  relatively longå¯èƒ½ç›¸å¯¹è¾ƒé•¿</p>
<ul>
<li>long delay before  resending lost packet</li>
<li>increase end-to-end delay</li>
</ul>
</li>
<li>
<p>detect lost segments via  duplicate ACKs</p>
<ul>
<li>sender often sends many  segments back-to-back (è¿ç»­)</li>
<li>if segment is lost, there  will likely be many duplicate ACKs</li>
</ul>
</li>
<li>
<p>In the case that <strong>three duplicate ACKs</strong> are received, the TCP sender performs a <strong>fast retransmit</strong></p>
<ul>
<li>retransmitting the missing segment before that segmentâ€™s timer expires</li>
</ul>
</li>
</ul>

<ul>
<li>é€‰æ‹©ç¡®è®¤ï¼ˆselective acknowledgmentï¼‰ï¼šå…è®¸TCPæ¥æ”¶æ–¹æœ‰é€‰æ‹©åœ°ç¡®è®¤å¤±åºæŠ¥æ–‡æ®µï¼Œè€Œä¸æ˜¯ç´¯ç§¯åœ°ç¡®è®¤æœ€åä¸€ä¸ªæ­£ç¡®æ¥æ”¶çš„æœ‰åºæŠ¥æ–‡æ®µ</li>
</ul>
<h3 id="3-5-5-Flow-Controlï¼Œæµé‡æ§åˆ¶">3.5.5 Flow Controlï¼Œæµé‡æ§åˆ¶</h3>
<ul>
<li>When the TCP connection receives bytes that are correct and in sequence, it places the data in the receive bufferï¼Œæ­£ç¡®å­—èŠ‚=ã€‹æ¥æ”¶ç¼“å­˜</li>
<li>The associated application process will read data from this buffer, but not necessarily at the instant the data arrivesï¼Œåº”ç”¨è¯»å–ï¼Œä½†éç«‹åˆ»è¯»å–</li>
<li>f the application is relatively slow at reading the data, the sender can very easily overflow the connectionâ€™s receive buffer by sending too much data too quicklyï¼Œä½¿è¯¥è¿æ¥çš„æ¥æ”¶ç¼“å­˜æº¢å‡º</li>
<li>TCP provides a <strong>flow-control service</strong>(æµé‡æ§åˆ¶æœåŠ¡) to its applications to eliminate the possibility of the sender overflowing the receiverâ€™s buffer</li>
<li>Flow control is a <u>speed-matching service</u>é€Ÿåº¦åŒ¹é…æœåŠ¡â€”matching the rate at which the sender is sending against the rate at which the receiving application is reading</li>
<li><strong>congestion control</strong>æ‹¥å¡æ§åˆ¶ï¼šTCPå‘é€æ–¹ä¹Ÿå¯èƒ½å› ä¸ºIPç½‘ç»œçš„æ‹¥å¡è€Œè¢«éåˆ¶</li>
</ul>

<ul>
<li>
<p>TCP provides flow control by having the sender maintain a variable called the <strong>receive window</strong>ï¼ˆæ¥æ”¶çª—å£ï¼‰=ã€‹ï¼ˆhow much free buffer space is available at the receiverï¼‰</p>
</li>
<li>
<p>Because TCP is full-duplex, the sender at each side of the connection maintains a distinct receive windowï¼ˆåŒæ–¹çš†æœ‰ï¼‰</p>
</li>
<li>
<p>RevBufferï¼šdenote receive bufferâ€˜s  size</p>
</li>
<li>
<p>ä¾‹</p>
<ul>
<li>
<p>Host A is sending a large file to  Host B over a TCP connection,  allocates a receive buffer  RcvBuffer(æ¥æ”¶ç¼“å­˜ï¼‰</p>
</li>
<li>
<p>LastByteRead: the number of the  last byte in the data stream read  from the buffer by the  application process in Bï¼Œä¸»æœº Bä¸Šçš„åº”ç”¨è¿›ç¨‹ä»ç¼“å­˜è¯»å‡ºçš„æ•°æ®æµçš„æœ€åä¸€ä¸ªå­—èŠ‚çš„ç¼–å· (åº”ç”¨å±‚ä»ç¼“å­˜ä¸­è¯»å–çš„æœ€æ–°ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·)</p>
</li>
<li>
<p>LastByteRead: the number of the  last byte in the data stream read  from the buffer by the  application process in Bï¼Œä»ç½‘ç»œä¸­åˆ°è¾¾çš„å¹¶ä¸”å·²æ”¾å…¥ä¸»æœº Bæ¥æ”¶ç¼“å­˜ä¸­çš„æ•°æ®æµçš„æœ€åä¸€ä¸ªå­—èŠ‚çš„ç¼–å· (åº”ç”¨å±‚ä»ç¼“å­˜ä¸­è¯»å–çš„æœ€æ–°ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·)</p>
</li>
<li>
<p>TCP is not permitted to overflow the allocated bufferï¼š</p>
<ul>
<li>LastByteRcvd â€“ LastByteRead &lt;= RcvBuffer</li>
</ul>
</li>
<li>
<p>denoted <u>rwnd</u> (receive windows) is set to the amount of spare  room in the buffer (æ¥æ”¶ç¼“å­˜ä¸­ç©ºé—²ç©ºé—´)</p>
<ul>
<li>rwnd = RcvBuffer â€“ [LastByteRcvd â€“ LastByteRead]</li>
</ul>
</li>
<li>
<p>How does the connection use the variable <u>rwnd</u> to provide the flow-control service?</p>
<ul>
<li>Host B tells Host A how much spare room it has in the connection buffer by (placing its <strong>current value of rwnd</strong> in the <strong>receive window field</strong> of <u>every segment it sends to A</u>), æŠŠå½“å‰çš„rwnd å€¼æ”¾å…¥å®ƒå‘ç»™ä¸»æœº A çš„æŠ¥æ–‡æ®µæ¥æ”¶çª—å£å­—æ®µä¸­</li>
<li>Initially, Host B sets <u>rwnd =RcvBuffer</u></li>
</ul>

</li>
<li>
<p>LastByteSent-LastByteAckedï¼Œå°±æ˜¯ä¸»æœºAå‘é€åˆ°è¿æ¥ä¸­ä½†æœªè¢«ç¡®è®¤çš„æ•°æ®é‡ã€‚é€šè¿‡å°†æœªç¡®è®¤çš„æ•°æ®é‡æ§åˆ¶åœ¨å€¼ rwnd ä»¥å†…ï¼Œå°±å¯ä»¥ä¿è¯ä¸»æœº A ä¸ä¼šä½¿ä¸»æœºBçš„æ¥æ”¶ç¼“å­˜æº¢å‡ºã€‚å› æ­¤ï¼Œä¸»æœº Aåœ¨è¯¥è¿æ¥çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸé¡»ä¿è¯âˆ¶ LastByteSent -LastByteAcked â‰¤ rwnd</p>
</li>
<li>
<p>the TCP specification requires:</p>
</li>
<li>
<p>Host A to <u>continue to send segments</u> with <strong>one data byte</strong> when <u>Bâ€™s receive window</u> is <strong>zero</strong>. These segments will be acknowledged by the receiver</p>
</li>
<li>
<p>Eventually the buffer will <u>begin to empty</u> and the <u>acknowledgments</u> will contain a <strong>nonzero rwnd value</strong></p>
</li>
<li>
<p>receiver â€œadvertisesâ€ free buffer  space by including rwnd value in  TCP header of receiver-to-sender  segments</p>
<ul>
<li>RcvBuffer size set via socket  options (typical default is 4096  bytes)</li>
<li>many operating systems  autoadjust RcvBuffers</li>
</ul>
</li>
<li>
<p>sender limits amount of unacked (â€œin-flightâ€) data according to  receiverâ€™s rwnd value</p>

</li>
</ul>
</li>
</ul>
<h3 id="3-5-6-TCP-Connection-Management-TCPè¿æ¥ç®¡ç†">3.5.6 TCP Connection Management,TCPè¿æ¥ç®¡ç†</h3>
<ul>
<li>
<p>The TCP in the client then proceeds to establish a TCP connection with the TCP in the server in the following manner:</p>
</li>
<li>
<p>:one:client-side TCP first sends <u>a special TCP segment</u>(<strong>SYN segment</strong>) to the server-side TCP</p>
<ul>
<li>ontains no application-layer data</li>
<li>the <strong>SYN bit</strong> is set to <strong>1</strong></li>
<li>the client <strong>randomly</strong> chooses an <strong>initial sequence number</strong>(<strong>client_isn</strong>)and puts this number in the <strong>sequence number field</strong> of the <u>initial TCP SYN segment</u></li>
<li>This segment is <u>encapsulated</u> within an <u>IP datagram</u> and sent to the server</li>
</ul>
</li>
<li>
<p>:two:server host receives SYN,  replies with SYNACK segment</p>
<p>â€‹	 (the server extracts(æå–) the <u>TCP SYN segment</u> from the <u>datagram</u>, allocates(åˆ†é…) the <strong>TCP buffers</strong> and <strong>variables</strong> to the <u>connection</u>, and <u>sends</u> a <strong>connection-granted segment</strong> to the client TCPï¼Œå‘é€å…è®¸è¿æ¥çš„æŠ¥æ–‡)</p>
<ul>
<li>also contains no application-layer data</li>
<li>the <strong>SYN bit</strong> is set to 1</li>
<li>the <strong>acknowledgment field</strong> of the TCP segment header is set to <strong>client_isn+1</strong></li>
<li>the server <u>chooses</u> its own <strong>initial sequence number(server_isn)</strong> and puts this value in the sequence number field of the TCP segment header</li>
</ul>
<p>(æˆ‘æ”¶åˆ°äº†ä½ å‘èµ·å»ºç«‹è¿æ¥çš„ SYN åˆ†ç»„ï¼Œè¯¥åˆ†ç»„å¸¦æœ‰åˆå§‹åºå· client_isnã€‚æˆ‘åŒæ„å»ºç«‹è¯¥è¿æ¥ã€‚æˆ‘è‡ªå·±çš„åˆå§‹åºå·æ˜¯ server_isn,The connection-granted segment is referred to as a <strong>SYNACK segment</strong>)</p>
</li>
<li>
<p>:three:Upon receiving the SYNACK segment, the client also allocates buffers and variables to the connection</p>
<ul>
<li>The client host then sends the server yet another segment, this last segment acknowledges the serverâ€™s connection-granted segment
<ul>
<li>putting the value <strong>server_isn+1</strong> in the <strong>acknowledgment field</strong> of the TCP segment header</li>
<li>the <strong>SYN bit</strong> is set to <strong>zero</strong>, since the connection is established</li>
</ul>
</li>
<li>This third stage of the three-way handshake may carry client-to-server data in the segment payload</li>
</ul>
</li>
<li>
<p>Once these three steps have been completed, the client and server hosts can send segments containing data to each other</p>
</li>
<li>
<p>In each of these <u>future</u> segments, the <u>SYN</u> bit will be set to <u>zero</u></p>
</li>
</ul>

<ul>
<li>
<p>Either of the two processes participating in a TCP connection can end the connection. When a connection ends, the&quot;resources&quot;(that is, the buffers and variables) in the hosts are deallocated, ä»»ä½•ä¸€æ–¹å‡å¯ç»ˆæ­¢ï¼Œç»ˆæ­¢åèµ„æºé‡Šæ”¾</p>
<ul>
<li>the client TCP to send a special TCP segment to the server process
<ul>
<li>has a flag bit in the segmentâ€™s header, the <strong>FIN bit</strong>, set to <strong>1</strong></li>
</ul>
</li>
<li>When the server receives this segment, it sends the client an <strong>acknowledgment segment</strong> in return</li>
<li>The server then sends its own <strong>shutdown segment</strong>(ç»ˆæ­¢æŠ¥æ–‡), which has the <strong>FIN bit</strong> set to <strong>1</strong></li>
<li>the client <strong>acknowledges</strong> the serverâ€™s shutdown segment( this point, <strong>all</strong> the resources in the two hosts are now <strong>deallocated</strong>)</li>
<li>Timed Wait: lets TCP client  resend final ack. in case lost,  typical values are 30 seconds, 1 minute, and 2 minutesï¼ˆSå¦‚æœåœ¨Timeoutå†…æœªæ”¶åˆ°Cçš„ACKï¼Œåˆ™å°†é‡æ–°å‘é€FINã€‚Cåœ¨Timed waité‡Œé¢è‹¥å†æ¬¡æ”¶åˆ°æ¥è‡ªSçš„FINï¼Œå°†é‡å‘ ACKå¹¶é‡æ–°è¿›å…¥åˆ°Timed wait çŠ¶æ€ï¼Œç¡®ä¿Sèƒ½è¿›å…¥åˆ°å…³é—­ï¼‰</li>
<li>Note: with small modification,  can handle simultaneous  FINs</li>
</ul>

</li>
<li>
<p>During the life of a TCP connection, the TCP protocol [running in each host] makes transitions through various <strong>TCP states</strong>(TCP çŠ¶æ€)</p>
</li>
</ul>



<ul>
<li>
<p>RST segment:</p>
<ul>
<li>when receiving a TCP segment whose port number or source  IP address do not match with any of the ongoing socket  (receiver side)
<ul>
<li>Host send a special RST segment to source (å¦‚æœæ˜¯TCP)</li>
<li>Tell it â€œI donâ€™t have a socket for that segment, psl donâ€™t  resendâ€</li>
<li>Host send a special ICMP datagram for UDP case (å¦‚æœæ˜¯UDP)</li>
</ul>
</li>
</ul>
</li>
<li>
<p>How to scan the target host port?  If you send a TCP SYN segment with destination port  6789</p>
<ul>
<li>(1) receives a TCP SYN ACK from destination: an  application is running with TCP port 6789</li>
<li>(2) receives a TCP RST from destination: the target host  is not running with TCP port 6789, attacker knows the  segment arrived in the host and are not blocked by  firewall</li>
<li>(3) receives nothing: SYN segment was likely blocked by  firewall and never reached the target host</li>
</ul>
</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="category-chain-item">è®¡ç®—æœºç½‘ç»œ</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/02/20/%E7%AC%AC%E4%B8%89%E7%AB%A0%E8%BF%90%E8%BE%93%E5%B1%826/" title="ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆå…­ï¼‰">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆå…­ï¼‰</span>
                        <span class="visible-mobile">Vorheriger</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/02/20/%E7%AC%AC%E4%B8%89%E7%AB%A0%E8%BF%90%E8%BE%93%E5%B1%824/" title="ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆå››ï¼‰">
                        <span class="hidden-mobile">ç¬¬ä¸‰ç« -è¿è¾“å±‚ï¼ˆå››ï¼‰</span>
                        <span class="visible-mobile">NÃ¤chster</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      

    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Inhaltsverzeichnis</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Suchen</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Stichwort</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a target="_blank" rel="nofollow noopener"><span>ğŸŸ</span></a> <a target="_blank" rel="nofollow noopener"><span>ğŸŸ</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog funktioniert am besten mit aktiviertem JavaScript</div>
  </noscript>
</body>
</html>
